<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Database Fetch Example</title>
</head>

<body>
    <h1>Deployment History</h1>
    <div id="dataContainer"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.1.2/firebase-app.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/9.1.2/firebase-database.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDAsGSaps-o0KwXTF-5q3Z99knmyXPmSfU",
            authDomain: "smartgarbagebin-8c3ec.firebaseapp.com",
            databaseURL: "https://smartgarbagebin-8c3ec-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "smartgarbagebin-8c3ec",
            storageBucket: "smartgarbagebin-8c3ec.appspot.com",
            messagingSenderId: "1062286948871",
            appId: "1:1062286948871:web:d62f6f620e010f8f22c8a2",
        };

        // Initialize Firebase app
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        const deploymentHistoryRef = ref(db, 'DeploymentHistory');

        // Function to fetch and display data with status "complete"
        function fetchDataAndDisplay() {
            onValue(deploymentHistoryRef, (snapshot) => {
                const dataContainer = document.getElementById('dataContainer');
                dataContainer.innerHTML = ''; // Clear previous content

                snapshot.forEach((childSnapshot) => {
                    const scheduleData = childSnapshot.val();
                    const scheduleID = childSnapshot.key;

                    // Filter entries by status "complete"
                    if (scheduleData.status === "complete") {
                        const scheduleHTML = `
                            <div>
                                <h2>Schedule ID: ${scheduleID}</h2>
                                <p>Barangay: ${scheduleData.Barangay}</p>
                                <p>Biodegradable: ${scheduleData.Biodegradable}</p>
                                <p>Date Input: ${scheduleData.DateInput}</p>
                                <p>District: ${scheduleData.District}</p>
                                <p>Non-Biodegradable: ${scheduleData.NonBiodegradable}</p>
                                <p>Recyclables: ${scheduleData.Recyclables}</p>
                                <p>Special: ${scheduleData.Special}</p>
                                <p>Total Quota: ${scheduleData.TotalQuota}</p>
                                <p>Status: ${scheduleData.status}</p>
                            </div>
                        `;

                        dataContainer.innerHTML += scheduleHTML;
                    }
                });
            });
        }

        // Execute fetchDataAndDisplay function after DOM content is fully loaded
        document.addEventListener('DOMContentLoaded', fetchDataAndDisplay);
    </script>
</body>

</html>